{% extends "dashboard/base.html" %} {% block title %}Messages - Dashboard{%
endblock %} {% block page_title %}Messages{% endblock %} {% block content %}
<div class="row">
    <div class="col-12">
        <div class="card">
            <div
                class="card-header d-flex justify-content-between align-items-center"
            >
                <h5 class="mb-0">
                    <i class="fas fa-envelope me-2"></i>Contact Messages
                </h5>
                <div>
                    <select class="form-select form-select-sm" style="width: auto; display: inline-block; margin-right: 10px;" onchange="window.location.href='{{ url_for('dashboard_messages') }}?priority=' + this.value">
                        <option value="all" {% if priority_filter == 'all' %}selected{% endif %}>All Priority</option>
                        <option value="high" {% if priority_filter == 'high' %}selected{% endif %}>游댮 High</option>
                        <option value="normal" {% if priority_filter == 'normal' %}selected{% endif %}>游리 Normal</option>
                        <option value="low" {% if priority_filter == 'low' %}selected{% endif %}>游릭 Low</option>
                    </select>
                    <div class="badge bg-primary">{{ messages|length }} Messages</div>
                </div>
            </div>
            <div class="card-body">
                {% if messages %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead style="background: var(--gold-gradient)">
                            <tr>
                                <th
                                    style="
                                        color: #000000 !important;
                                        font-weight: 600;
                                    "
                                >
                                    Status
                                </th>
                                <th
                                    style="
                                        color: #000000 !important;
                                        font-weight: 600;
                                    "
                                >
                                    Name
                                </th>
                                <th
                                    style="
                                        color: #000000 !important;
                                        font-weight: 600;
                                    "
                                >
                                    Email
                                </th>
                                <th
                                    style="
                                        color: #000000 !important;
                                        font-weight: 600;
                                    "
                                >
                                    Message Preview
                                </th>
                                <th
                                    style="
                                        color: #000000 !important;
                                        font-weight: 600;
                                    "
                                >
                                    Date
                                </th>
                                <th
                                    style="
                                        color: #000000 !important;
                                        font-weight: 600;
                                    "
                                >
                                    Actions
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for message in messages %}
                            <tr
                                class="{{ 'table-light' if message.read else 'table-warning' }}"
                            >
                                <td>
                                    {% if message.read %}
                                    <span class="badge bg-success">
                                        <i class="fas fa-check"></i> Read
                                    </span>
                                    {% else %}
                                    <span class="badge bg-warning">
                                        <i class="fas fa-circle"></i> New
                                    </span>
                                    {% endif %}
                                    <br>
                                    {% if message.priority == 'high' %}
                                    <span class="badge bg-danger mt-1"><i class="fas fa-exclamation-circle"></i> 游댮 High</span>
                                    {% elif message.priority == 'low' %}
                                    <span class="badge bg-info mt-1"><i class="fas fa-check-circle"></i> 游릭 Low</span>
                                    {% else %}
                                    <span class="badge bg-secondary mt-1"><i class="fas fa-minus-circle"></i> 游리 Normal</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <strong style="color: #000000 !important;">{{ message.name }}</strong>
                                </td>
                                <td>
                                    <a
                                        href="mailto:{{ message.email }}"
                                        class="text-decoration-none"
                                        style="color: #0066cc !important;"
                                    >
                                        {{ message.email }}
                                    </a>
                                </td>
                                <td>
                                    <p class="mb-0" style="color: #333333 !important;">
                                        {{ message.message[:80] }}{% if
                                        message.message|length > 80 %}...{%
                                        endif %}
                                    </p>
                                </td>
                                <td>
                                    <small style="color: #666666 !important;"
                                        >{{ message.date }}</small
                                    >
                                </td>
                                <td>
                                    <div class="btn-group" role="group">
                                        <a
                                            href="{{ url_for('dashboard_view_message', message_id=message.id) }}"
                                            class="btn btn-outline-primary btn-sm"
                                            title="View Message"
                                        >
                                            <i class="fas fa-eye"></i>
                                        </a>
                                        <a
                                            href="{{ url_for('dashboard_convert_message_to_client', message_id=message.id) }}"
                                            class="btn btn-success btn-sm"
                                            onclick="return confirm('Convert this message to a client?')"
                                            title="Convert to Client"
                                        >
                                            <i class="fas fa-user-plus"></i>
                                        </a>
                                        <a
                                            href="mailto:{{ message.email }}"
                                            class="btn btn-outline-info btn-sm"
                                            title="Reply"
                                        >
                                            <i class="fas fa-reply"></i>
                                        </a>
                                        <a
                                            href="{{ url_for('dashboard_delete_message', message_id=message.id) }}"
                                            class="btn btn-outline-danger btn-sm"
                                            onclick="return confirm('Are you sure you want to delete this message?')"
                                            title="Delete Message"
                                        >
                                            <i class="fas fa-trash"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center text-muted py-5">
                    <i class="fas fa-envelope-open fa-3x mb-3 opacity-50"></i>
                    <h5>No Messages Yet</h5>
                    <p>
                        When visitors send messages through your contact form,
                        they will appear here.
                    </p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

{% if messages %}
<div class="row mt-4">
    <div class="col-lg-4">
        <div class="card bg-primary text-white">
            <div class="card-body text-center">
                <i class="fas fa-envelope fa-2x mb-2"></i>
                <h5>Total Messages</h5>
                <h3>{{ messages|length }}</h3>
            </div>
        </div>
    </div>
    <div class="col-lg-4">
        <div class="card bg-warning text-white">
            <div class="card-body text-center">
                <i class="fas fa-exclamation-circle fa-2x mb-2"></i>
                <h5>Unread Messages</h5>
                <h3>{{ messages|selectattr('read', 'false')|list|length }}</h3>
            </div>
        </div>
    </div>
    <div class="col-lg-4">
        <div class="card bg-success text-white">
            <div class="card-body text-center">
                <i class="fas fa-check-circle fa-2x mb-2"></i>
                <h5>Read Messages</h5>
                <h3>{{ messages|selectattr('read', 'true')|list|length }}</h3>
            </div>
        </div>
    </div>
</div>
{% endif %} {% endblock %}
